<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Matt Dancho" />

<meta name="date" content="2017-04-30" />

<title>Time Series Coercion Using timekit</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Time Series Coercion Using timekit</h1>
<h4 class="author"><em>Matt Dancho</em></h4>
<h4 class="date"><em>2017-04-30</em></h4>


<div id="TOC">
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#case-study-coercion-issues-with-ts">Case Study: Coercion issues with ts()</a><ul>
<li><a href="#problems">Problems</a></li>
<li><a href="#solution">Solution</a></li>
<li><a href="#advantages-of-coercion-with-tk_tbl">Advantages of coercion with tk_tbl()</a></li>
</ul></li>
<li><a href="#coercion-methods">Coercion Methods</a><ul>
<li><a href="#from-tbl">From tbl</a></li>
<li><a href="#to-tbl">To tbl</a></li>
</ul></li>
<li><a href="#additional-concepts">Additional Concepts</a><ul>
<li><a href="#testing-if-an-object-has-a-timekit-index">Testing if an object has a timekit index</a></li>
<li><a href="#coercing-ts-to-xts-and-zoo">Coercing ts to xts and zoo</a></li>
<li><a href="#working-with-yearmon-and-yearqtr-index">Working with yearmon and yearqtr index</a></li>
<li><a href="#getting-the-index-of-other-time-based-objects-e.g.models">Getting the index of other time-based objects (e.g. models)</a></li>
</ul></li>
</ul>
</div>

<blockquote>
<p>Simplified and extensible time series coercion tools</p>
</blockquote>
<p>The time series landscape in R is vast, deep, and complex causing many inconsistencies in data attributes and formats ultimately making it difficult to coerce between the different data structures. The <code>zoo</code> and <code>xts</code> packages solved a number of the issues in dealing with the various classes (<code>ts</code>, <code>zoo</code>, <code>xts</code>, <code>irts</code>, <code>msts</code>, and the list goes on…). However, because these packages deal in classes other than data frame, the issues with coercion between <code>tbl</code> and other time series object classes are still present.</p>
<p>The <code>timekit</code> package provides tools that solve the issues with coercion, maximizing attribute extensibility (the required data attributes are retained during the coercion to each of the primary time series classes). The following tools are available to coerce and retrieve key information:</p>
<ul>
<li><p><strong>Coercion functions</strong>: <code>tk_tbl</code>, <code>tk_ts</code>, <code>tk_xts</code>, <code>tk_zoo</code>, and <code>tk_zooreg</code>. These functions coerce time-based tibbles <code>tbl</code> to and from each of the main time-series data types <code>xts</code>, <code>zoo</code>, <code>zooreg</code>, <code>ts</code>, maintaining the time-based index.</p></li>
<li><p><strong>Index function</strong>: <code>tk_index</code> returns the index. When the argument, <code>timekit_idx = TRUE</code>, A time-based index (non-regularized index) of <code>forecast</code> objects, models, and <code>ts</code> objects is returned if present. Refer to <code>tk_ts()</code> to learn about non-regularized index persistence during the coercion process.</p></li>
</ul>
<p>This vignette includes a brief case study on coercion issues and then a detailed explanation of <code>timekit</code> function coercion between time-based <code>tbl</code> objects and several primary time series classes (<code>xts</code>, <code>zoo</code>, <code>zooreg</code> and <code>ts</code>).</p>
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>Before we get started, load the following packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyquant)
<span class="kw">library</span>(timekit)</code></pre></div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>We’ll use the ten-year treasury rate available from the FRED database with the code, “DGS10”. We’ll retrieve the data set using <code>tq_get(get = &quot;economic.data&quot;)</code>. The return structure is a tibble (or “tidy” data frame), which is not conducive to many of the popular time series analysis packages including <code>quantmod</code>, <code>TTR</code>, <code>forecast</code> and many others.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ten_year_treasury_rate_tbl &lt;-<span class="st"> </span><span class="kw">tq_get</span>(<span class="st">&quot;DGS10&quot;</span>, 
                                     <span class="dt">get  =</span> <span class="st">&quot;economic.data&quot;</span>, 
                                     <span class="dt">from =</span> <span class="st">&quot;1997-01-01&quot;</span>, 
                                     <span class="dt">to   =</span> <span class="st">&quot;2016-12-31&quot;</span>) %&gt;%
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">pct =</span> price) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pct =</span> pct /<span class="st"> </span><span class="dv">100</span>)
ten_year_treasury_rate_tbl</code></pre></div>
<pre><code>## # A tibble: 5,218 × 2
##          date    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-01-01     NA
## 2  1997-01-02 0.0654
## 3  1997-01-03 0.0652
## 4  1997-01-06 0.0654
## 5  1997-01-07 0.0657
## 6  1997-01-08 0.0660
## 7  1997-01-09 0.0652
## 8  1997-01-10 0.0663
## 9  1997-01-13 0.0663
## 10 1997-01-14 0.0653
## # ... with 5,208 more rows</code></pre>
<p>For purposes of the Case Study, we’ll change to a quarterly periodicity using <code>tq_transmute()</code> from the <code>tidyquant</code> package. Note that <code>NA</code> values are automatically removed from the data (message not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ten_year_treasury_rate_tbl &lt;-<span class="st"> </span>ten_year_treasury_rate_tbl %&gt;%
<span class="st">    </span><span class="kw">tq_transmute</span>(pct, <span class="dt">mutate_fun =</span> to.period, <span class="dt">period =</span> <span class="st">&quot;quarters&quot;</span>)
ten_year_treasury_rate_tbl</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##          date    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="case-study-coercion-issues-with-ts" class="section level1">
<h1>Case Study: Coercion issues with ts()</h1>
<p>The <code>ts</code> object class has roots in the <code>stats</code> package and many popular packages use this time series data structure including the popular <code>forecast</code> package. With that said, the <code>ts</code> data structure is the most difficult to coerce back and forth because by default it does not contain a time-based index. Rather it uses a regularized index computed using the <code>start</code> and <code>frequency</code> arguments. Coercion to <code>ts</code> is done using the <code>ts()</code> function from the <code>stats</code> library, which results in various problems.</p>
<div id="problems" class="section level2">
<h2>Problems</h2>
<p>First, only numeric columns get coerced. If the user forgets to add the <code>[,&quot;pct&quot;]</code> to drop the “date” column, <code>ts()</code> returns dates in numeric format which is not what the user wants.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># date column gets coerced to numeric</span>
<span class="kw">ts</span>(ten_year_treasury_rate_tbl, <span class="dt">start =</span> <span class="dv">1997</span>, <span class="dt">freq =</span> <span class="dv">4</span>) %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##          date    pct
## 1997 Q1  9951 0.0692
## 1997 Q2 10042 0.0651
## 1997 Q3 10134 0.0612
## 1997 Q4 10226 0.0575
## 1998 Q1 10316 0.0567
## 1998 Q2 10407 0.0544</code></pre>
<p>The correct method is to call the specific column desired. However, this presents a new issue. The date index is lost, and a different “regularized” index is built using the <code>start</code> and <code>frequency</code> attributes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ten_year_treasury_rate_ts_stats &lt;-<span class="st"> </span><span class="kw">ts</span>(ten_year_treasury_rate_tbl[,<span class="st">&quot;pct&quot;</span>], 
                                      <span class="dt">start =</span> <span class="dv">1997</span>, 
                                      <span class="dt">freq  =</span> <span class="dv">4</span>)
ten_year_treasury_rate_ts_stats</code></pre></div>
<pre><code>##        Qtr1   Qtr2   Qtr3   Qtr4
## 1997 0.0692 0.0651 0.0612 0.0575
## 1998 0.0567 0.0544 0.0444 0.0465
## 1999 0.0525 0.0581 0.0590 0.0645
## 2000 0.0603 0.0603 0.0580 0.0512
## 2001 0.0493 0.0542 0.0460 0.0507
## 2002 0.0542 0.0486 0.0363 0.0383
## 2003 0.0383 0.0354 0.0396 0.0427
## 2004 0.0386 0.0462 0.0414 0.0424
## 2005 0.0450 0.0394 0.0434 0.0439
## 2006 0.0486 0.0515 0.0464 0.0471
## 2007 0.0465 0.0503 0.0459 0.0404
## 2008 0.0345 0.0399 0.0385 0.0225
## 2009 0.0271 0.0353 0.0331 0.0385
## 2010 0.0384 0.0297 0.0253 0.0330
## 2011 0.0347 0.0318 0.0192 0.0189
## 2012 0.0223 0.0167 0.0165 0.0178
## 2013 0.0187 0.0252 0.0264 0.0304
## 2014 0.0273 0.0253 0.0252 0.0217
## 2015 0.0194 0.0235 0.0206 0.0227
## 2016 0.0178 0.0149 0.0160 0.0245</code></pre>
<p>We can see from the structure (using the <code>str()</code> function) that the regularized time series is present, but there is no date index retained.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># No date index attribute</span>
<span class="kw">str</span>(ten_year_treasury_rate_ts_stats)</code></pre></div>
<pre><code>##  Time-Series [1:80, 1] from 1997 to 2017: 0.0692 0.0651 0.0612 0.0575 0.0567 0.0544 0.0444 0.0465 0.0525 0.0581 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr &quot;pct&quot;</code></pre>
<p>We can get the index using the <code>index()</code> function from the <code>zoo</code> package. The index retained is a regular sequence of numeric values. In many cases, the regularized values cannot be coerced back to the original time-base because the date and date time data contains significantly more information (i.e. year-month-day, hour-minute-second, and timezone attributes) and the data may not be on a regularized interval (frequency).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Regularized numeric sequence</span>
<span class="kw">index</span>(ten_year_treasury_rate_ts_stats)</code></pre></div>
<pre><code>##  [1] 1997.00 1997.25 1997.50 1997.75 1998.00 1998.25 1998.50 1998.75
##  [9] 1999.00 1999.25 1999.50 1999.75 2000.00 2000.25 2000.50 2000.75
## [17] 2001.00 2001.25 2001.50 2001.75 2002.00 2002.25 2002.50 2002.75
## [25] 2003.00 2003.25 2003.50 2003.75 2004.00 2004.25 2004.50 2004.75
## [33] 2005.00 2005.25 2005.50 2005.75 2006.00 2006.25 2006.50 2006.75
## [41] 2007.00 2007.25 2007.50 2007.75 2008.00 2008.25 2008.50 2008.75
## [49] 2009.00 2009.25 2009.50 2009.75 2010.00 2010.25 2010.50 2010.75
## [57] 2011.00 2011.25 2011.50 2011.75 2012.00 2012.25 2012.50 2012.75
## [65] 2013.00 2013.25 2013.50 2013.75 2014.00 2014.25 2014.50 2014.75
## [73] 2015.00 2015.25 2015.50 2015.75 2016.00 2016.25 2016.50 2016.75</code></pre>
</div>
<div id="solution" class="section level2">
<h2>Solution</h2>
<p>The <code>timekit</code> package contains a new function, <code>tk_ts()</code>, that enables maintaining the original date index as an attribute. When we repeat the <code>tbl</code> to <code>ts</code> coercion process using the new function, <code>tk_ts()</code>, we can see a few differences.</p>
<p>First, only numeric columns get coerced, which prevents unintended consequences due to R coercion rules (e.g. dates getting unintentionally converted or characters causing the homogeneous data structure converting all numeric values to character). If a column is dropped, the user gets a warning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># date automatically dropped and user is warned</span>
ten_year_treasury_rate_ts_timekit &lt;-<span class="st"> </span><span class="kw">tk_ts</span>(ten_year_treasury_rate_tbl, 
                                         <span class="dt">start =</span> <span class="dv">1997</span>, 
                                         <span class="dt">freq  =</span> <span class="dv">4</span>)</code></pre></div>
<pre><code>## Warning in tk_xts_.data.frame(ret, select = select, silent = silent): Non-
## numeric columns being dropped: date</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ten_year_treasury_rate_ts_timekit</code></pre></div>
<pre><code>##        Qtr1   Qtr2   Qtr3   Qtr4
## 1997 0.0692 0.0651 0.0612 0.0575
## 1998 0.0567 0.0544 0.0444 0.0465
## 1999 0.0525 0.0581 0.0590 0.0645
## 2000 0.0603 0.0603 0.0580 0.0512
## 2001 0.0493 0.0542 0.0460 0.0507
## 2002 0.0542 0.0486 0.0363 0.0383
## 2003 0.0383 0.0354 0.0396 0.0427
## 2004 0.0386 0.0462 0.0414 0.0424
## 2005 0.0450 0.0394 0.0434 0.0439
## 2006 0.0486 0.0515 0.0464 0.0471
## 2007 0.0465 0.0503 0.0459 0.0404
## 2008 0.0345 0.0399 0.0385 0.0225
## 2009 0.0271 0.0353 0.0331 0.0385
## 2010 0.0384 0.0297 0.0253 0.0330
## 2011 0.0347 0.0318 0.0192 0.0189
## 2012 0.0223 0.0167 0.0165 0.0178
## 2013 0.0187 0.0252 0.0264 0.0304
## 2014 0.0273 0.0253 0.0252 0.0217
## 2015 0.0194 0.0235 0.0206 0.0227
## 2016 0.0178 0.0149 0.0160 0.0245</code></pre>
<p>Second, the data returned has a few additional attributes. The most important of which is a numeric attribute, “index”, which contains the original date information as a number. The <code>ts()</code> function will not preserve this index while <code>tk_ts()</code> will preserve the index in numeric form along with the time zone and class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># More attributes including time index, time class, time zone</span>
<span class="kw">str</span>(ten_year_treasury_rate_ts_timekit)</code></pre></div>
<pre><code>##  Time-Series [1:80, 1] from 1997 to 2017: 0.0692 0.0651 0.0612 0.0575 0.0567 0.0544 0.0444 0.0465 0.0525 0.0581 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr &quot;pct&quot;
##  - attr(*, &quot;index&quot;)= atomic [1:80] 8.60e+08 8.68e+08 8.76e+08 8.84e+08 8.91e+08 ...
##   ..- attr(*, &quot;tzone&quot;)= chr &quot;UTC&quot;
##   ..- attr(*, &quot;tclass&quot;)= chr &quot;Date&quot;
##  - attr(*, &quot;.indexCLASS&quot;)= chr &quot;Date&quot;
##  - attr(*, &quot;tclass&quot;)= chr &quot;Date&quot;
##  - attr(*, &quot;.indexTZ&quot;)= chr &quot;UTC&quot;
##  - attr(*, &quot;tzone&quot;)= chr &quot;UTC&quot;</code></pre>
</div>
<div id="advantages-of-coercion-with-tk_tbl" class="section level2">
<h2>Advantages of coercion with tk_tbl()</h2>
<p>Since we used the <code>tk_ts()</code> during coercion, we can extract the original index in date format using <code>tk_index(timekit_idx = TRUE)</code> (the default is <code>timekit_idx = FALSE</code> which returns the default regularized index).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Can now retrieve the original date index</span>
timekit_index &lt;-<span class="st"> </span><span class="kw">tk_index</span>(ten_year_treasury_rate_ts_timekit, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)
<span class="kw">head</span>(timekit_index)</code></pre></div>
<pre><code>## [1] &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; &quot;1998-03-31&quot;
## [6] &quot;1998-06-30&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(timekit_index)</code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>Next, the <code>tk_tbl()</code> function has an argument <code>timekit_idx</code> also which can be used to select which index to return. First, we show coercion using the default index. Notice that the index returned is “regularized” meaning its actually a numeric index rather than a time-based index.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Coercion back to tibble using the default index (regularized)</span>
ten_year_treasury_rate_ts_timekit %&gt;%
<span class="st">    </span><span class="kw">tk_tbl</span>(<span class="dt">index_rename =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">timekit_idx =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##            index    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
<p>We can now get the original date index using the <code>tk_tbl()</code> argument <code>timekit_idx = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Coercion back to tibble now using the timekit index (date / date-time)</span>
ten_year_treasury_rate_tbl_timekit &lt;-<span class="st"> </span>ten_year_treasury_rate_ts_timekit %&gt;%
<span class="st">    </span><span class="kw">tk_tbl</span>(<span class="dt">index_rename =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)
ten_year_treasury_rate_tbl_timekit</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
<p>We can see that in this case (and in most cases) you can get the same data frame you began with.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Comparing the coerced tibble with the original tibble</span>
<span class="kw">identical</span>(ten_year_treasury_rate_tbl_timekit, ten_year_treasury_rate_tbl)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="coercion-methods" class="section level1">
<h1>Coercion Methods</h1>
<p>Using the <code>ten_year_treasury_rate_tbl</code>, we’ll go through the various coercion methods using <code>tk_tbl</code>, <code>tk_xts</code>, <code>tk_zoo</code>, <code>tk_zooreg</code>, and <code>tk_ts</code>.</p>
<div id="from-tbl" class="section level2">
<h2>From tbl</h2>
<p>The starting point is the <code>ten_year_treasury_rate_tbl</code>. We will coerce this into <code>xts</code>, <code>zoo</code>, <code>zooreg</code> and <code>ts</code> classes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start:</span>
ten_year_treasury_rate_tbl</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##          date    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
<div id="to-xts" class="section level3">
<h3>to xts</h3>
<p>Use <code>tk_xts()</code>. By default “date” is used as the date index and the “date” column is dropped from the output. Only numeric columns are coerced to avoid unintentional coercion issues.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
ten_year_treasury_rate_xts &lt;-<span class="st"> </span><span class="kw">tk_xts</span>(ten_year_treasury_rate_tbl) </code></pre></div>
<pre><code>## Warning in tk_xts_.data.frame(data = data, select = select, date_var =
## date_var, : Non-numeric columns being dropped: date</code></pre>
<pre><code>## Using column `date` for date_var.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ten_year_treasury_rate_xts)</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
<p>Use the <code>select</code> argument to specify which columns to drop. Use the <code>date_var</code> argument to specify which column to use as the date index. Notice the message and warning are no longer present.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - Using `select` and `date_var` args</span>
<span class="kw">tk_xts</span>(ten_year_treasury_rate_tbl, <span class="dt">select =</span> -date, <span class="dt">date_var =</span> date) %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
<p>Also, as an alternative, we can set <code>silent = TRUE</code> to bypass the warnings since the default dropping of the “date” column is what is desired. Notice no warnings or messages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - Using `silent` to silence warnings</span>
<span class="kw">tk_xts</span>(ten_year_treasury_rate_tbl, <span class="dt">silent =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
</div>
<div id="to-zoo" class="section level3">
<h3>to zoo</h3>
<p>Use <code>tk_zoo()</code>. Same as when coercing to xts, the non-numeric “date” column is automatically dropped and the index is automatically selected as the date column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
ten_year_treasury_rate_zoo &lt;-<span class="st"> </span><span class="kw">tk_zoo</span>(ten_year_treasury_rate_tbl, <span class="dt">silent =</span> <span class="ot">TRUE</span>) 
<span class="kw">head</span>(ten_year_treasury_rate_zoo)</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
</div>
<div id="to-zooreg" class="section level3">
<h3>to zooreg</h3>
<p>Use <code>tk_zooreg()</code>. Same as when coercing to xts, the non-numeric “date” column is automatically dropped. The regularized index is built from the function arguments <code>start</code> and <code>freq</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
ten_year_treasury_rate_zooreg &lt;-<span class="st"> </span><span class="kw">tk_zooreg</span>(ten_year_treasury_rate_tbl, 
                                           <span class="dt">start  =</span> <span class="dv">1997</span>, 
                                           <span class="dt">freq   =</span> <span class="dv">4</span>,
                                           <span class="dt">silent =</span> <span class="ot">TRUE</span>) 
<span class="kw">head</span>(ten_year_treasury_rate_zooreg)</code></pre></div>
<pre><code>##            pct
## 1997 Q1 0.0692
## 1997 Q2 0.0651
## 1997 Q3 0.0612
## 1997 Q4 0.0575
## 1998 Q1 0.0567
## 1998 Q2 0.0544</code></pre>
<p>The original time-based index is retained and can be accessed using <code>tk_index(timekit_idx = TRUE)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Retrieve original time-based index</span>
<span class="kw">tk_index</span>(ten_year_treasury_rate_zooreg, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">    </span><span class="kw">str</span>()</code></pre></div>
<pre><code>##  Date[1:80], format: &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; ...</code></pre>
</div>
<div id="to-ts" class="section level3">
<h3>to ts</h3>
<p>Use <code>tk_ts()</code>. The non-numeric “date” column is automatically dropped. The regularized index is built from the function arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
ten_year_treasury_rate_ts &lt;-<span class="st"> </span><span class="kw">tk_ts</span>(ten_year_treasury_rate_tbl, 
                                   <span class="dt">start  =</span> <span class="dv">1997</span>, 
                                   <span class="dt">freq   =</span> <span class="dv">4</span>,
                                   <span class="dt">silent =</span> <span class="ot">TRUE</span>) 
ten_year_treasury_rate_ts</code></pre></div>
<pre><code>##        Qtr1   Qtr2   Qtr3   Qtr4
## 1997 0.0692 0.0651 0.0612 0.0575
## 1998 0.0567 0.0544 0.0444 0.0465
## 1999 0.0525 0.0581 0.0590 0.0645
## 2000 0.0603 0.0603 0.0580 0.0512
## 2001 0.0493 0.0542 0.0460 0.0507
## 2002 0.0542 0.0486 0.0363 0.0383
## 2003 0.0383 0.0354 0.0396 0.0427
## 2004 0.0386 0.0462 0.0414 0.0424
## 2005 0.0450 0.0394 0.0434 0.0439
## 2006 0.0486 0.0515 0.0464 0.0471
## 2007 0.0465 0.0503 0.0459 0.0404
## 2008 0.0345 0.0399 0.0385 0.0225
## 2009 0.0271 0.0353 0.0331 0.0385
## 2010 0.0384 0.0297 0.0253 0.0330
## 2011 0.0347 0.0318 0.0192 0.0189
## 2012 0.0223 0.0167 0.0165 0.0178
## 2013 0.0187 0.0252 0.0264 0.0304
## 2014 0.0273 0.0253 0.0252 0.0217
## 2015 0.0194 0.0235 0.0206 0.0227
## 2016 0.0178 0.0149 0.0160 0.0245</code></pre>
<p>The original time-based index is retained and can be accessed using <code>tk_index(timekit_idx = TRUE)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Retrieve original time-based index</span>
<span class="kw">tk_index</span>(ten_year_treasury_rate_ts, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">    </span><span class="kw">str</span>()</code></pre></div>
<pre><code>##  Date[1:80], format: &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; ...</code></pre>
</div>
</div>
<div id="to-tbl" class="section level2">
<h2>To tbl</h2>
<p>Going back to tibble is just as easy using <code>tk_tbl()</code>.</p>
<div id="from-xts" class="section level3">
<h3>From xts</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start</span>
<span class="kw">head</span>(ten_year_treasury_rate_xts)</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
<p>Notice no loss of data going back to <code>tbl</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_xts)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="from-zoo" class="section level3">
<h3>From zoo</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start</span>
<span class="kw">head</span>(ten_year_treasury_rate_zoo)</code></pre></div>
<pre><code>##               pct
## 1997-03-31 0.0692
## 1997-06-30 0.0651
## 1997-09-30 0.0612
## 1997-12-31 0.0575
## 1998-03-31 0.0567
## 1998-06-30 0.0544</code></pre>
<p>Notice no loss of data going back to <code>tbl</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End</span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_zoo)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="from-zooreg" class="section level3">
<h3>From zooreg</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start</span>
<span class="kw">head</span>(ten_year_treasury_rate_zooreg)</code></pre></div>
<pre><code>##            pct
## 1997 Q1 0.0692
## 1997 Q2 0.0651
## 1997 Q3 0.0612
## 1997 Q4 0.0575
## 1998 Q1 0.0567
## 1998 Q2 0.0544</code></pre>
<p>Notice that the index is a regularized numeric sequence by default.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - with default regularized index</span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_zooreg)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##            index    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
<p>With <code>timekit_idx = TRUE</code> the index is the original date sequence. The result is the original <code>tbl</code> that we started with!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - with timekit index that is the same as original time-based index</span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_zooreg, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="from-ts" class="section level3">
<h3>From ts</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start</span>
ten_year_treasury_rate_ts</code></pre></div>
<pre><code>##        Qtr1   Qtr2   Qtr3   Qtr4
## 1997 0.0692 0.0651 0.0612 0.0575
## 1998 0.0567 0.0544 0.0444 0.0465
## 1999 0.0525 0.0581 0.0590 0.0645
## 2000 0.0603 0.0603 0.0580 0.0512
## 2001 0.0493 0.0542 0.0460 0.0507
## 2002 0.0542 0.0486 0.0363 0.0383
## 2003 0.0383 0.0354 0.0396 0.0427
## 2004 0.0386 0.0462 0.0414 0.0424
## 2005 0.0450 0.0394 0.0434 0.0439
## 2006 0.0486 0.0515 0.0464 0.0471
## 2007 0.0465 0.0503 0.0459 0.0404
## 2008 0.0345 0.0399 0.0385 0.0225
## 2009 0.0271 0.0353 0.0331 0.0385
## 2010 0.0384 0.0297 0.0253 0.0330
## 2011 0.0347 0.0318 0.0192 0.0189
## 2012 0.0223 0.0167 0.0165 0.0178
## 2013 0.0187 0.0252 0.0264 0.0304
## 2014 0.0273 0.0253 0.0252 0.0217
## 2015 0.0194 0.0235 0.0206 0.0227
## 2016 0.0178 0.0149 0.0160 0.0245</code></pre>
<p>Notice that the index is a regularized numeric sequence by default.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - with default regularized index</span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_ts)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##            index    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
<p>With <code>timekit_idx = TRUE</code> the index is the original date sequence. The result is the original <code>tbl</code> that we started with!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># End - with timekit index </span>
<span class="kw">tk_tbl</span>(ten_year_treasury_rate_ts, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
</div>
</div>
<div id="additional-concepts" class="section level1">
<h1>Additional Concepts</h1>
<p>This section covers additional concepts that the user may find useful when working with time series.</p>
<div id="testing-if-an-object-has-a-timekit-index" class="section level2">
<h2>Testing if an object has a timekit index</h2>
<p>The function <code>has_timekit_idx()</code> can be used to test whether toggling the <code>timekit_idx</code> argument in the <code>tk_index()</code> and <code>tk_tbl()</code> functions will have an effect on the output. Here are several examples using the ten year treasury data used in the case study:</p>
<div id="testing-ts" class="section level3">
<h3>Testing ts()</h3>
<p>There’s no “timekit index” if the <code>ts()</code> function is used. The solution is to use <code>tk_ts()</code> to coerce the to <code>ts</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Data coerced with stats::ts() has no timekit index</span>
<span class="kw">has_timekit_idx</span>(ten_year_treasury_rate_ts_stats)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>If we try to toggle <code>timekit_idx = TRUE</code> when retrieving the index with <code>tk_index()</code>, we get a warning and the default regularized time series is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(ten_year_treasury_rate_ts_stats, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in tk_index.ts(ten_year_treasury_rate_ts_stats, timekit_idx =
## TRUE): timekit attribute `index` not found. Returning default instead.</code></pre>
<pre><code>##  [1] 1997.00 1997.25 1997.50 1997.75 1998.00 1998.25 1998.50 1998.75
##  [9] 1999.00 1999.25 1999.50 1999.75 2000.00 2000.25 2000.50 2000.75
## [17] 2001.00 2001.25 2001.50 2001.75 2002.00 2002.25 2002.50 2002.75
## [25] 2003.00 2003.25 2003.50 2003.75 2004.00 2004.25 2004.50 2004.75
## [33] 2005.00 2005.25 2005.50 2005.75 2006.00 2006.25 2006.50 2006.75
## [41] 2007.00 2007.25 2007.50 2007.75 2008.00 2008.25 2008.50 2008.75
## [49] 2009.00 2009.25 2009.50 2009.75 2010.00 2010.25 2010.50 2010.75
## [57] 2011.00 2011.25 2011.50 2011.75 2012.00 2012.25 2012.50 2012.75
## [65] 2013.00 2013.25 2013.50 2013.75 2014.00 2014.25 2014.50 2014.75
## [73] 2015.00 2015.25 2015.50 2015.75 2016.00 2016.25 2016.50 2016.75</code></pre>
<p>If we try to toggle <code>timekit_idx = TRUE</code> during coercion to <code>tbl</code> using <code>tk_tbl()</code>, we get a warning and the default regularized time series is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_tbl</span>(ten_year_treasury_rate_ts_stats, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in tk_tbl.zooreg(zoo::as.zoo(data), preserve_index, rename_index, :
## No `timekit index` attribute found. Using regularized index.</code></pre>
<pre><code>## # A tibble: 80 × 2
##            index    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="testing-tk_ts" class="section level3">
<h3>Testing tk_ts()</h3>
<p>The <code>tk_ts()</code> function returns an object with the “timekit index” attribute.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Data coerced with tk_ts() has timekit index</span>
<span class="kw">has_timekit_idx</span>(ten_year_treasury_rate_ts_timekit)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If we toggle <code>timekit_idx = TRUE</code> when retrieving the index with <code>tk_index()</code>, we get the index of dates rather than the regularized time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(ten_year_treasury_rate_ts_timekit, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; &quot;1998-03-31&quot;
##  [6] &quot;1998-06-30&quot; &quot;1998-09-30&quot; &quot;1998-12-31&quot; &quot;1999-03-31&quot; &quot;1999-06-30&quot;
## [11] &quot;1999-09-30&quot; &quot;1999-12-31&quot; &quot;2000-03-31&quot; &quot;2000-06-30&quot; &quot;2000-09-29&quot;
## [16] &quot;2000-12-29&quot; &quot;2001-03-30&quot; &quot;2001-06-29&quot; &quot;2001-09-28&quot; &quot;2001-12-31&quot;
## [21] &quot;2002-03-28&quot; &quot;2002-06-28&quot; &quot;2002-09-30&quot; &quot;2002-12-31&quot; &quot;2003-03-31&quot;
## [26] &quot;2003-06-30&quot; &quot;2003-09-30&quot; &quot;2003-12-31&quot; &quot;2004-03-31&quot; &quot;2004-06-30&quot;
## [31] &quot;2004-09-30&quot; &quot;2004-12-31&quot; &quot;2005-03-31&quot; &quot;2005-06-30&quot; &quot;2005-09-30&quot;
## [36] &quot;2005-12-30&quot; &quot;2006-03-31&quot; &quot;2006-06-30&quot; &quot;2006-09-29&quot; &quot;2006-12-29&quot;
## [41] &quot;2007-03-30&quot; &quot;2007-06-29&quot; &quot;2007-09-28&quot; &quot;2007-12-31&quot; &quot;2008-03-31&quot;
## [46] &quot;2008-06-30&quot; &quot;2008-09-30&quot; &quot;2008-12-31&quot; &quot;2009-03-31&quot; &quot;2009-06-30&quot;
## [51] &quot;2009-09-30&quot; &quot;2009-12-31&quot; &quot;2010-03-31&quot; &quot;2010-06-30&quot; &quot;2010-09-30&quot;
## [56] &quot;2010-12-31&quot; &quot;2011-03-31&quot; &quot;2011-06-30&quot; &quot;2011-09-30&quot; &quot;2011-12-30&quot;
## [61] &quot;2012-03-30&quot; &quot;2012-06-29&quot; &quot;2012-09-28&quot; &quot;2012-12-31&quot; &quot;2013-03-28&quot;
## [66] &quot;2013-06-28&quot; &quot;2013-09-30&quot; &quot;2013-12-31&quot; &quot;2014-03-31&quot; &quot;2014-06-30&quot;
## [71] &quot;2014-09-30&quot; &quot;2014-12-31&quot; &quot;2015-03-31&quot; &quot;2015-06-30&quot; &quot;2015-09-30&quot;
## [76] &quot;2015-12-31&quot; &quot;2016-03-31&quot; &quot;2016-06-30&quot; &quot;2016-09-30&quot; &quot;2016-12-30&quot;</code></pre>
<p>If we toggle <code>timekit_idx = TRUE</code> during coercion to <code>tbl</code> using <code>tk_tbl()</code>, we get the index of dates rather than the regularized index in the returned <code>tbl</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_tbl</span>(ten_year_treasury_rate_ts_timekit, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##         index    pct
##        &lt;date&gt;  &lt;dbl&gt;
## 1  1997-03-31 0.0692
## 2  1997-06-30 0.0651
## 3  1997-09-30 0.0612
## 4  1997-12-31 0.0575
## 5  1998-03-31 0.0567
## 6  1998-06-30 0.0544
## 7  1998-09-30 0.0444
## 8  1998-12-31 0.0465
## 9  1999-03-31 0.0525
## 10 1999-06-30 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="testing-other-data-types" class="section level3">
<h3>Testing other data types</h3>
<p>The <code>timekit_idx</code> argument will only have an effect on objects that use regularized time series. Therefore, <code>has_timekit_idx()</code> returns <code>FALSE</code> for other object types (e.g. <code>tbl</code>, <code>xts</code>, <code>zoo</code>) since toggling the argument has no effect on these classes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">has_timekit_idx</span>(ten_year_treasury_rate_xts)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Toggling the <code>timekit_idx</code> argument has no effect on the output. Output with <code>timekit_idx = TRUE</code> is the same as with <code>timekit_idx = FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(ten_year_treasury_rate_xts, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; &quot;1998-03-31&quot;
##  [6] &quot;1998-06-30&quot; &quot;1998-09-30&quot; &quot;1998-12-31&quot; &quot;1999-03-31&quot; &quot;1999-06-30&quot;
## [11] &quot;1999-09-30&quot; &quot;1999-12-31&quot; &quot;2000-03-31&quot; &quot;2000-06-30&quot; &quot;2000-09-29&quot;
## [16] &quot;2000-12-29&quot; &quot;2001-03-30&quot; &quot;2001-06-29&quot; &quot;2001-09-28&quot; &quot;2001-12-31&quot;
## [21] &quot;2002-03-28&quot; &quot;2002-06-28&quot; &quot;2002-09-30&quot; &quot;2002-12-31&quot; &quot;2003-03-31&quot;
## [26] &quot;2003-06-30&quot; &quot;2003-09-30&quot; &quot;2003-12-31&quot; &quot;2004-03-31&quot; &quot;2004-06-30&quot;
## [31] &quot;2004-09-30&quot; &quot;2004-12-31&quot; &quot;2005-03-31&quot; &quot;2005-06-30&quot; &quot;2005-09-30&quot;
## [36] &quot;2005-12-30&quot; &quot;2006-03-31&quot; &quot;2006-06-30&quot; &quot;2006-09-29&quot; &quot;2006-12-29&quot;
## [41] &quot;2007-03-30&quot; &quot;2007-06-29&quot; &quot;2007-09-28&quot; &quot;2007-12-31&quot; &quot;2008-03-31&quot;
## [46] &quot;2008-06-30&quot; &quot;2008-09-30&quot; &quot;2008-12-31&quot; &quot;2009-03-31&quot; &quot;2009-06-30&quot;
## [51] &quot;2009-09-30&quot; &quot;2009-12-31&quot; &quot;2010-03-31&quot; &quot;2010-06-30&quot; &quot;2010-09-30&quot;
## [56] &quot;2010-12-31&quot; &quot;2011-03-31&quot; &quot;2011-06-30&quot; &quot;2011-09-30&quot; &quot;2011-12-30&quot;
## [61] &quot;2012-03-30&quot; &quot;2012-06-29&quot; &quot;2012-09-28&quot; &quot;2012-12-31&quot; &quot;2013-03-28&quot;
## [66] &quot;2013-06-28&quot; &quot;2013-09-30&quot; &quot;2013-12-31&quot; &quot;2014-03-31&quot; &quot;2014-06-30&quot;
## [71] &quot;2014-09-30&quot; &quot;2014-12-31&quot; &quot;2015-03-31&quot; &quot;2015-06-30&quot; &quot;2015-09-30&quot;
## [76] &quot;2015-12-31&quot; &quot;2016-03-31&quot; &quot;2016-06-30&quot; &quot;2016-09-30&quot; &quot;2016-12-30&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(ten_year_treasury_rate_xts, <span class="dt">timekit_idx =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##  [1] &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; &quot;1998-03-31&quot;
##  [6] &quot;1998-06-30&quot; &quot;1998-09-30&quot; &quot;1998-12-31&quot; &quot;1999-03-31&quot; &quot;1999-06-30&quot;
## [11] &quot;1999-09-30&quot; &quot;1999-12-31&quot; &quot;2000-03-31&quot; &quot;2000-06-30&quot; &quot;2000-09-29&quot;
## [16] &quot;2000-12-29&quot; &quot;2001-03-30&quot; &quot;2001-06-29&quot; &quot;2001-09-28&quot; &quot;2001-12-31&quot;
## [21] &quot;2002-03-28&quot; &quot;2002-06-28&quot; &quot;2002-09-30&quot; &quot;2002-12-31&quot; &quot;2003-03-31&quot;
## [26] &quot;2003-06-30&quot; &quot;2003-09-30&quot; &quot;2003-12-31&quot; &quot;2004-03-31&quot; &quot;2004-06-30&quot;
## [31] &quot;2004-09-30&quot; &quot;2004-12-31&quot; &quot;2005-03-31&quot; &quot;2005-06-30&quot; &quot;2005-09-30&quot;
## [36] &quot;2005-12-30&quot; &quot;2006-03-31&quot; &quot;2006-06-30&quot; &quot;2006-09-29&quot; &quot;2006-12-29&quot;
## [41] &quot;2007-03-30&quot; &quot;2007-06-29&quot; &quot;2007-09-28&quot; &quot;2007-12-31&quot; &quot;2008-03-31&quot;
## [46] &quot;2008-06-30&quot; &quot;2008-09-30&quot; &quot;2008-12-31&quot; &quot;2009-03-31&quot; &quot;2009-06-30&quot;
## [51] &quot;2009-09-30&quot; &quot;2009-12-31&quot; &quot;2010-03-31&quot; &quot;2010-06-30&quot; &quot;2010-09-30&quot;
## [56] &quot;2010-12-31&quot; &quot;2011-03-31&quot; &quot;2011-06-30&quot; &quot;2011-09-30&quot; &quot;2011-12-30&quot;
## [61] &quot;2012-03-30&quot; &quot;2012-06-29&quot; &quot;2012-09-28&quot; &quot;2012-12-31&quot; &quot;2013-03-28&quot;
## [66] &quot;2013-06-28&quot; &quot;2013-09-30&quot; &quot;2013-12-31&quot; &quot;2014-03-31&quot; &quot;2014-06-30&quot;
## [71] &quot;2014-09-30&quot; &quot;2014-12-31&quot; &quot;2015-03-31&quot; &quot;2015-06-30&quot; &quot;2015-09-30&quot;
## [76] &quot;2015-12-31&quot; &quot;2016-03-31&quot; &quot;2016-06-30&quot; &quot;2016-09-30&quot; &quot;2016-12-30&quot;</code></pre>
</div>
</div>
<div id="coercing-ts-to-xts-and-zoo" class="section level2">
<h2>Coercing ts to xts and zoo</h2>
<p>It’s common to need to coerce data stored as data frame or another structure with a time-base to <code>ts</code> to perform some analysis. It’s also common to need to coerce it from the regularized structure to a time-based structure such as <code>xts</code> or <code>zoo</code> to perform further analysis within your workflow. Traditionally coercing a <code>ts</code> class object to an <code>xts</code> or <code>zoo</code> class object was difficult or impossible since the <code>ts</code> object does not maintain a time-based index and the <code>xts</code> and <code>zoo</code> objects require the <code>order.by</code> argument to specify a time-based index. The <code>zoo</code> package contains some regularizing functions (<code>yearmon</code> and <code>yearqtr</code>) that can be converted to dates, but there is no easy method to coerce <code>ts</code> objects on frequencies such as daily until now. The general process is as follows:</p>
<ol style="list-style-type: decimal">
<li>Begin with an object with a time-based index in date or date-time format. Typically this would be a data frame (<code>tbl</code>) or <code>xts</code> object.</li>
<li>Coerce to <code>ts</code> using the <code>tk_ts()</code> function setting the <code>start</code> and <code>frequency</code> parameters for regularization. This generates a regularized <code>ts</code> object as normal, but using the <code>tk_ts()</code> function also maintains the time-based “timekit index”.</li>
<li>Coerce to xts or zoo using <code>tk_xts()</code> or <code>tk_zoo()</code> respectively.</li>
</ol>
<p>Here’s a quick example. Our starting point is a tibble (<code>tbl</code>) but it could be another time-based object such as <code>xts</code> or <code>zoo</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Start with a date or date-time indexed data frame</span>
data_tbl &lt;-<span class="st"> </span>tibble::<span class="kw">tibble</span>(
    <span class="dt">date =</span> <span class="kw">seq.Date</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2016-01-01&quot;</span>), <span class="dt">by =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">5</span>),
    <span class="dt">x    =</span> <span class="kw">cumsum</span>(<span class="dv">11</span>:<span class="dv">15</span>) *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>))
data_tbl</code></pre></div>
<pre><code>## # A tibble: 5 × 2
##         date          x
##       &lt;date&gt;      &lt;dbl&gt;
## 1 2016-01-01  -6.792565
## 2 2016-01-02 -14.202636
## 3 2016-01-03 -22.230214
## 4 2016-01-04 -30.875297
## 5 2016-01-05 -40.137886</code></pre>
<p>Coerce to <code>ts</code> class using the <code>tk_ts()</code> function. Note that the non-numeric column “date” is being dropped, and the <code>silent = TRUE</code> hides the message.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Coerce to ts </span>
data_ts &lt;-<span class="st"> </span><span class="kw">tk_ts</span>(data_tbl, <span class="dt">start =</span> <span class="dv">2016</span>, <span class="dt">freq =</span> <span class="dv">365</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)
data_ts</code></pre></div>
<pre><code>## Time Series:
## Start = c(2016, 1) 
## End = c(2016, 5) 
## Frequency = 365 
##               x
## [1,]  -6.792565
## [2,] -14.202636
## [3,] -22.230214
## [4,] -30.875297
## [5,] -40.137886
## attr(,&quot;index&quot;)
## [1] 1451606400 1451692800 1451779200 1451865600 1451952000
## attr(,&quot;index&quot;)attr(,&quot;tzone&quot;)
## [1] UTC
## attr(,&quot;index&quot;)attr(,&quot;tclass&quot;)
## [1] Date
## attr(,&quot;.indexCLASS&quot;)
## [1] Date
## attr(,&quot;tclass&quot;)
## [1] Date
## attr(,&quot;.indexTZ&quot;)
## [1] UTC
## attr(,&quot;tzone&quot;)
## [1] UTC</code></pre>
<p>Coercion to <code>xts</code> normally requires a date or datetime index to be passed to the <code>order.by</code> argument. However, when coercing <code>ts</code> objects created with <code>tk_ts()</code>, the <code>tk_xts</code> function automatically uses the “timekit index” if present.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Inspect timekit index</span>
<span class="kw">has_timekit_idx</span>(data_ts)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If the “timekit index” is present, the user can simply pass the <code>ts</code> object to the coercion function (<code>tk_xts()</code>), which will automatically use the “timekit index” to order by.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># No need to specify order.by arg</span>
data_xts &lt;-<span class="st"> </span><span class="kw">tk_xts</span>(data_ts)
data_xts</code></pre></div>
<pre><code>##                     x
## 2016-01-01  -6.792565
## 2016-01-02 -14.202636
## 2016-01-03 -22.230214
## 2016-01-04 -30.875297
## 2016-01-05 -40.137886</code></pre>
<p>We can see that the <code>xts</code> structure is maintained.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(data_xts)</code></pre></div>
<pre><code>## An 'xts' object on 2016-01-01/2016-01-05 containing:
##   Data: num [1:5, 1] -6.79 -14.2 -22.23 -30.88 -40.14
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr &quot;x&quot;
##   Indexed by objects of class: [Date] TZ: UTC
##   xts Attributes:  
##  NULL</code></pre>
<p>The same process can be used to coerce from <code>ts</code> to <code>zoo</code> class using <code>tk_zoo</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># No need to specify order.by arg</span>
data_zoo &lt;-<span class="st"> </span><span class="kw">tk_zoo</span>(data_ts)
data_zoo</code></pre></div>
<pre><code>##                     x
## 2016-01-01  -6.792565
## 2016-01-02 -14.202636
## 2016-01-03 -22.230214
## 2016-01-04 -30.875297
## 2016-01-05 -40.137886</code></pre>
<p>We can see that the <code>zoo</code> structure is maintained.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(data_zoo)</code></pre></div>
<pre><code>## 'zoo' series from 2016-01-01 to 2016-01-05
##   Data: num [1:5, 1] -6.79 -14.2 -22.23 -30.88 -40.14
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:5] &quot;2016-01-01&quot; &quot;2016-01-02&quot; &quot;2016-01-03&quot; &quot;2016-01-04&quot; ...
##   ..$ : chr &quot;x&quot;
##   Index:  Date[1:5], format: &quot;2016-01-01&quot; &quot;2016-01-02&quot; &quot;2016-01-03&quot; &quot;2016-01-04&quot; ...</code></pre>
<p>Note that <code>tbl</code> requires the <code>timekit_idx = TRUE</code> argument to specify the use of the non-regularized index.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_tbl</span>(data_ts, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 5 × 2
##        index          x
##       &lt;date&gt;      &lt;dbl&gt;
## 1 2016-01-01  -6.792565
## 2 2016-01-02 -14.202636
## 3 2016-01-03 -22.230214
## 4 2016-01-04 -30.875297
## 5 2016-01-05 -40.137886</code></pre>
</div>
<div id="working-with-yearmon-and-yearqtr-index" class="section level2">
<h2>Working with yearmon and yearqtr index</h2>
<p>The <code>zoo</code> package has the <code>yearmon</code> and <code>yearqtr</code> classes for working with regularized monthly and quarterly data, respectively. The “timekit index” tracks the format during coercion. Here’s and example with <code>yearqtr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yearqtr_tbl &lt;-<span class="st"> </span>ten_year_treasury_rate_tbl %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.yearqtr</span>(date))
yearqtr_tbl</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##             date    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
<p>We can coerce to <code>xts</code> and the <code>yearqtr</code> class is intact.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yearqtr_xts &lt;-<span class="st"> </span><span class="kw">tk_xts</span>(yearqtr_tbl)</code></pre></div>
<pre><code>## Warning in tk_xts_.data.frame(data = data, select = select, date_var =
## date_var, : Non-numeric columns being dropped: date</code></pre>
<pre><code>## Using column `date` for date_var.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yearqtr_xts %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##            pct
## 1997 Q1 0.0692
## 1997 Q2 0.0651
## 1997 Q3 0.0612
## 1997 Q4 0.0575
## 1998 Q1 0.0567
## 1998 Q2 0.0544</code></pre>
<p>We can coerce to <code>ts</code> and, although the “timekit index” is hidden, the <code>yearqtr</code> class is intact.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yearqtr_ts &lt;-<span class="st"> </span><span class="kw">tk_ts</span>(yearqtr_xts, <span class="dt">start =</span> <span class="dv">1997</span>, <span class="dt">freq =</span> <span class="dv">4</span>)
yearqtr_ts %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##        Qtr1   Qtr2   Qtr3   Qtr4
## 1997 0.0692 0.0651 0.0612 0.0575
## 1998 0.0567 0.0544</code></pre>
<p>Coercing from <code>ts</code> to <code>tbl</code> using <code>timekit_idx = TRUE</code> shows that the original index was maintained through each of the coercion steps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yearqtr_ts %&gt;%
<span class="st">    </span><span class="kw">tk_tbl</span>(<span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 80 × 2
##            index    pct
##    &lt;S3: yearqtr&gt;  &lt;dbl&gt;
## 1        1997 Q1 0.0692
## 2        1997 Q2 0.0651
## 3        1997 Q3 0.0612
## 4        1997 Q4 0.0575
## 5        1998 Q1 0.0567
## 6        1998 Q2 0.0544
## 7        1998 Q3 0.0444
## 8        1998 Q4 0.0465
## 9        1999 Q1 0.0525
## 10       1999 Q2 0.0581
## # ... with 70 more rows</code></pre>
</div>
<div id="getting-the-index-of-other-time-based-objects-e.g.models" class="section level2">
<h2>Getting the index of other time-based objects (e.g. models)</h2>
<p>It can be important to retrieve the index from models and other objects that use an underlying time series data set. We’ll go through an example retrieving the time index from an ARIMA model using <code>tk_index()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forecast)
fit_arima &lt;-<span class="st"> </span>ten_year_treasury_rate_ts %&gt;%
<span class="st">    </span><span class="kw">auto.arima</span>()</code></pre></div>
<p>We can get the time index from the ARIMA model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(fit_arima)</code></pre></div>
<pre><code>##  [1] 1997.00 1997.25 1997.50 1997.75 1998.00 1998.25 1998.50 1998.75
##  [9] 1999.00 1999.25 1999.50 1999.75 2000.00 2000.25 2000.50 2000.75
## [17] 2001.00 2001.25 2001.50 2001.75 2002.00 2002.25 2002.50 2002.75
## [25] 2003.00 2003.25 2003.50 2003.75 2004.00 2004.25 2004.50 2004.75
## [33] 2005.00 2005.25 2005.50 2005.75 2006.00 2006.25 2006.50 2006.75
## [41] 2007.00 2007.25 2007.50 2007.75 2008.00 2008.25 2008.50 2008.75
## [49] 2009.00 2009.25 2009.50 2009.75 2010.00 2010.25 2010.50 2010.75
## [57] 2011.00 2011.25 2011.50 2011.75 2012.00 2012.25 2012.50 2012.75
## [65] 2013.00 2013.25 2013.50 2013.75 2014.00 2014.25 2014.50 2014.75
## [73] 2015.00 2015.25 2015.50 2015.75 2016.00 2016.25 2016.50 2016.75</code></pre>
<p>We can also get the original index from the ARIMA model be setting <code>timekit_idx = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tk_index</span>(fit_arima, <span class="dt">timekit_idx =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;1997-03-31&quot; &quot;1997-06-30&quot; &quot;1997-09-30&quot; &quot;1997-12-31&quot; &quot;1998-03-31&quot;
##  [6] &quot;1998-06-30&quot; &quot;1998-09-30&quot; &quot;1998-12-31&quot; &quot;1999-03-31&quot; &quot;1999-06-30&quot;
## [11] &quot;1999-09-30&quot; &quot;1999-12-31&quot; &quot;2000-03-31&quot; &quot;2000-06-30&quot; &quot;2000-09-29&quot;
## [16] &quot;2000-12-29&quot; &quot;2001-03-30&quot; &quot;2001-06-29&quot; &quot;2001-09-28&quot; &quot;2001-12-31&quot;
## [21] &quot;2002-03-28&quot; &quot;2002-06-28&quot; &quot;2002-09-30&quot; &quot;2002-12-31&quot; &quot;2003-03-31&quot;
## [26] &quot;2003-06-30&quot; &quot;2003-09-30&quot; &quot;2003-12-31&quot; &quot;2004-03-31&quot; &quot;2004-06-30&quot;
## [31] &quot;2004-09-30&quot; &quot;2004-12-31&quot; &quot;2005-03-31&quot; &quot;2005-06-30&quot; &quot;2005-09-30&quot;
## [36] &quot;2005-12-30&quot; &quot;2006-03-31&quot; &quot;2006-06-30&quot; &quot;2006-09-29&quot; &quot;2006-12-29&quot;
## [41] &quot;2007-03-30&quot; &quot;2007-06-29&quot; &quot;2007-09-28&quot; &quot;2007-12-31&quot; &quot;2008-03-31&quot;
## [46] &quot;2008-06-30&quot; &quot;2008-09-30&quot; &quot;2008-12-31&quot; &quot;2009-03-31&quot; &quot;2009-06-30&quot;
## [51] &quot;2009-09-30&quot; &quot;2009-12-31&quot; &quot;2010-03-31&quot; &quot;2010-06-30&quot; &quot;2010-09-30&quot;
## [56] &quot;2010-12-31&quot; &quot;2011-03-31&quot; &quot;2011-06-30&quot; &quot;2011-09-30&quot; &quot;2011-12-30&quot;
## [61] &quot;2012-03-30&quot; &quot;2012-06-29&quot; &quot;2012-09-28&quot; &quot;2012-12-31&quot; &quot;2013-03-28&quot;
## [66] &quot;2013-06-28&quot; &quot;2013-09-30&quot; &quot;2013-12-31&quot; &quot;2014-03-31&quot; &quot;2014-06-30&quot;
## [71] &quot;2014-09-30&quot; &quot;2014-12-31&quot; &quot;2015-03-31&quot; &quot;2015-06-30&quot; &quot;2015-09-30&quot;
## [76] &quot;2015-12-31&quot; &quot;2016-03-31&quot; &quot;2016-06-30&quot; &quot;2016-09-30&quot; &quot;2016-12-30&quot;</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
